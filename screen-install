#!/bin/bash
#
#    GNU screen-profiles-helper
#    Copyright (C) 2008 Canonical Ltd.
#
#    Authors: Nick Barcet <nick.barcet@ubuntu.com>
#
#    This program is free software; you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation; either version 2 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License along
#    with this program; if not, write to the Free Software Foundation, Inc.,
#    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.


LAUNCHER="$HOME/.screen-launcher"
BASHRC="$HOME/.bashrc"

# We have to make sure screen is called last
pos=$(( $(grep -ns "source $LAUNCHER" "$BASHRC" | sed 's/:.*$//' | head -1) ))

do=0
if [ $pos -gt 0 ]; then
    if [ $pos -lt $(( $(wc -l "$BASHRC" | sed "s/ .*$//") -2)) ]; then
        # We have to reposition the line at the end
        # First remove it
        sed -ibak '/screen-launcher/d' "$BASHRC"
        do=1
    fi
else
    do=1
fi

# Add it at the end
if [ $do -eq 1 ]; then
    echo "source $LAUNCHER" >> "$BASHRC"
fi

# Ensure that ~/.screen-launcher is a symbolic link
if [ -e "$HOME/.screen-launcher" ]; then
    if [ ! -L "$HOME/.screen-launcher" ]; then
        echo `gettext 'Error:'` $HOME/.screen-launcher `gettext ' file exists, but is not a symlink'`
        exit 1
    fi
else
    ln -s /usr/share/screen-profiles/screen-launcher "$HOME/.screen-launcher"
fi

