#!/bin/sh

BASE_DIR="/usr/share/screen-profiles"
PROFILE_DIR="$BASE_DIR/profiles"

if [ -e "$HOME/.screenrc-profile" ]; then
	if [ ! -L "$HOME/.screenrc-profile" ]; then
		echo `gettext 'Error:'` $HOME/.screenrc-profile `gettext 'exists, but is not a symlink'`
		exit 1
	fi
fi

echo
echo "Select a screen profile: "
i=0
profiles=$(ls $PROFILE_DIR)
for x in $profiles; do
	i=$(expr $i + 1)
	desc="          "
	if [ $x = "ubuntu.screenrc" ]; then
		desc="<---- ` gettext 'recommended'`"
		simple=$i
	fi
	echo "  $i. $x\t\t$desc"
done
echo
selected=x
while /bin/true; do
	if [ -z "$selected" -a ! -z "$simple" ]; then
		selected="$simple"
	elif ! test $selected -gt 0 2>/dev/null; then
		read -p "`gettext 'Choose'` 1-$i [$simple]: " -r selected
	elif ! test $selected -le $i 2>/dev/null; then
		read -p "`gettext 'Choose'` 1-$i [$simple]: " -r selected
	else
		break
	fi
done

i=0
for x in $profiles; do
	i=`expr $i + 1`
	if [ $i -eq $selected ]; then
        # avoid overriding a user's existing .screenrc
        if [ ! -e "$HOME/.screenrc" ]; then
            cp "$BASE_DIR/base-screenrc" "$HOME/.screenrc" && \
            chown "$USER" "$HOME/.screenrc"
        else
            echo "You already have a ~/.screenrc file. Make sure that it contains"
            echo "a line with 'source ~/.screenrc-profile' to make use of you new"
            echo "profile."
        fi
		rm -f "$HOME/.screenrc-profile" && ln -s "$PROFILE_DIR/$x" "$HOME/.screenrc-profile"
	fi
done

exit 0
