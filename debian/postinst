#!/bin/sh -e

. /usr/share/debconf/confmodule
db_version 2.0

PKG="byobu"

db_get byobu/launch-by-default || true
if [ "$RET" = true ]; then
	ln -sf /usr/bin/$PKG-launch /etc/profile.d/Z98-$PKG.sh
else
	rm -f /etc/profile.d/Z98-$PKG.sh
fi

# Clean up any old-school screen-profiles diversions of /usr/bin/screen
if [ -f /usr/bin/screen ] && [ -f /usr/bin/screen.real ]; then
	divertpkg=$(dpkg-divert --listpackage /usr/bin/screen)
	if [ "$divertpkg" = "screen-profiles" ]; then
		rm -f /usr/bin/screen
		dpkg-divert --package screen-profiles --rename --remove /usr/bin/screen
	fi
fi

# Remove the short-lived MOTD message
rm -f /etc/update-motd.d/55-window-manager

# Notify users that they should reload their profile
DIR="/var/run/screen"
if [ -d "$DIR" ]; then
	for d in "$DIR"/*; do
		[ -d "$d" ] || continue
		touch "$d/$PKG.reload-required"
		u=$(echo "$d" | sed "s:^.*/S-::")
		chown $u "$d/$PKG.reload-required"
		chmod 700 "$d/$PKG.reload-required"
	done
fi

#DEBHELPER#
